/*********************************************************************************************************
**
**                                    中国软件开源组织
**
**                                   嵌入式实时操作系统
**
**                                SylixOS(TM)  LW : long wing
**
**                               Copyright All Rights Reserved
**
**--------------文件信息--------------------------------------------------------------------------------
**
** 文   件   名: ipc.h
**
** 创   建   人: Han.Hui (韩辉)
**
** 文件创建日期: 2013 年 01 月 10 日
**
** 描        述: XSI IPC
*********************************************************************************************************/

#ifndef __SYS_IPC_H
#define __SYS_IPC_H

#include "types.h"

/*********************************************************************************************************
  权限结构
*********************************************************************************************************/

struct ipc_perm {
    uid_t       uid;                                                    /*  owner's effective user ID   */
    gid_t       gid;                                                    /*  owner's effective group ID  */
    uid_t       cuid;                                                   /*  creator's effective user ID */
    gid_t       cgid;                                                   /*  creator's effective group ID*/
    mode_t      mode;                                                   /*  read/write permission       */
};

/*********************************************************************************************************
  IPC Mode bits
*********************************************************************************************************/

#define IPC_CREAT           001000                                      /* Create if key does not exist */
#define IPC_EXCL            002000                                      /* Fail if key exists           */
#define IPC_NOWAIT          004000                                      /* Error if request must wait   */

/*********************************************************************************************************
  IPC Keys 
*********************************************************************************************************/

#define IPC_PRIVATE         ((key_t)0)                                  /* Private key                  */

/*********************************************************************************************************
  IPC Control commands 
*********************************************************************************************************/

#define IPC_RMID            0                                           /* Remove identifier            */
#define IPC_SET             1                                           /* Set options                  */
#define IPC_STAT            2                                           /* Get options                  */

/*********************************************************************************************************
  IPC common mode bits
*********************************************************************************************************/

#define IPC_R               000400                                      /* Read permission              */
#define IPC_W               000200                                      /* Write/alter permission       */
#define IPC_M               010000                                      /* Modify control info permissio*/

/*********************************************************************************************************
 Kernel implementation details which should not be utilized by user space programs.
*********************************************************************************************************/

#ifdef __SYLIXOS_KERNEL

/*********************************************************************************************************
 Macros to convert between ipc ids and array indices or sequence ids.
*********************************************************************************************************/

#define IPCID_TO_IX(id)             ((id) & 0xffff)
#define IPCID_TO_SEQ(id)            (((id) >> 16) & 0xffff)
#define IXSEQ_TO_IPCID(ix,perm)     (((perm._seq) << 16L) | ((ix) & 0xffff))

#endif                                                                  /*  __SYLIXOS_KERNEL            */

/*********************************************************************************************************
  XSI IPC API
*********************************************************************************************************/

#ifdef __cplusplus
extern "C" {
#endif                                                                  /*  __cplusplus                 */

key_t    ftok(const char *, int);

#ifdef __cplusplus
}
#endif                                                                  /*  __cplusplus                 */

#endif                                                                  /*  __SYS_IPC_H                 */
/*********************************************************************************************************
  END
*********************************************************************************************************/
