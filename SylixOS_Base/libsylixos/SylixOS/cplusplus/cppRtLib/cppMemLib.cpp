/*********************************************************************************************************
**
**                                    中国软件开源组织
**
**                                   嵌入式实时操作系统
**
**                                SylixOS(TM)  LW : long wing
**
**                               Copyright All Rights Reserved
**
**--------------文件信息--------------------------------------------------------------------------------
**
** 文   件   名: cppMemLib.cpp
**
** 创   建   人: Han.Hui (韩辉)
**
** 文件创建日期: 2009 年 10 月 14 日
**
** 描        述: 操作系统平台 C++ 内存支持 (重载 new, delete 运算符). 
                 (为内核模块提供简单的 C++ 支持, 应用程序则使用 libstdc++ or libsupc++)

** BUG:
2011.03.06  使用 __SHEAP... 宏, 方便内存跟踪工具.
*********************************************************************************************************/
#include "SylixOS.h"
/*********************************************************************************************************
  C++ 专用内存开辟函数
*********************************************************************************************************/
extern "C" {
PVOID  lib_malloc_new(size_t  stNBytes);
}
/*********************************************************************************************************
** 函数名称: new
** 功能描述: 重载 new 运算.
** 输　入  : stSize        内存大小
** 输　出  : 分配的内存指针.
** 全局变量: 
** 调用模块: 
*********************************************************************************************************/
void  *operator  new (size_t   stSize)
{
    return  ((void *)lib_malloc_new(stSize));
}
/*********************************************************************************************************
** 函数名称: new[]
** 功能描述: 重载 new 运算.
** 输　入  : stSize        内存大小
** 输　出  : 分配的内存指针.
** 全局变量: 
** 调用模块: 
*********************************************************************************************************/
void  *operator  new[] (size_t   stSize)
{
    return  ((void *)lib_malloc_new(stSize));
}
/*********************************************************************************************************
** 函数名称: delete
** 功能描述: 重载 delete 运算.
** 输　入  : pvMem         需要释放的内存首指针
** 输　出  : NONE
** 全局变量: 
** 调用模块: 
*********************************************************************************************************/
void  operator  delete (void  *pvMem)
{
    if (pvMem) {
        lib_free(pvMem);
    }
}
/*********************************************************************************************************
** 函数名称: delete
** 功能描述: 重载 delete 运算.
** 输　入  : pvMem         需要释放的内存首指针
** 输　出  : NONE
** 全局变量: 
** 调用模块: 
*********************************************************************************************************/
void  operator  delete[] (void  *pvMem)
{
    if (pvMem) {
        lib_free(pvMem);
    }
}
/*********************************************************************************************************
  END
*********************************************************************************************************/
