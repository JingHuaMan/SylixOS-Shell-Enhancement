;/*********************************************************************************************************
;**
;**                                    中国软件开源组织
;**
;**                                   嵌入式实时操作系统
;**
;**                                       SylixOS(TM)
;**
;**                               Copyright  All Rights Reserved
;**
;**--------------文件信息--------------------------------------------------------------------------------
;**
;** 文   件   名: cskyContextCK803Asm.h
;**
;** 创   建   人: Wang.Xuan (王Q)
;**
;** 文件创建日期: 2018 年 11 月 12 日
;**
;** 描        述: C-SKY CK803 体系架构上下文处理.
;*********************************************************************************************************/

#ifndef __ARCH_CSKYCONTEXTCK803ASM_H
#define __ARCH_CSKYCONTEXTCK803ASM_H

#include "arch/csky/arch_regs.h"

;/*********************************************************************************************************
;  保存寄存器(参数 A1: ARCH_REG_CTX 地址)
;*********************************************************************************************************/

MACRO_DEF(SAVE_REGS)
    STM         R0-R15 , (A1)

    ST.W        R28, (A1 , XGREG28)

    ST.W        RA , (A1 , XPC)                                         ;/*  RA 代替 PC 保存             */
    
    MFCR        A2 , PSR
    ST.W        A2 , (A1 , XPSR)                                        ;/*  保存 PSR 寄存器             */
    MACRO_END()

;/*********************************************************************************************************
;  恢复寄存器(参数 A1: ARCH_REG_CTX 地址)
;*********************************************************************************************************/

MACRO_DEF(RESTORE_REGS)
    LD.W        A0 , (A1 , XPSR)                                        ;/*  恢复 PSR 寄存器             */
    MTCR        A0 , EPSR

    LD.W        A0 , (A1 , XPC)                                         ;/*  恢复 PC 寄存器              */
    MTCR        A0 , EPC

    LD.W        R28, (A1 , XGREG28)

    LD.W        R0 , (A1 , XGREG(0))

    ADDI        A1 , (2 * ARCH_REG_SIZE)
    LDM         R2-R15 , (A1)
    SUBI        A1 , (2 * ARCH_REG_SIZE)
    LD.W        A1 , (A1 , XGREG(1))

    RTE
    MACRO_END()

#endif
;/*********************************************************************************************************
;  END
;*********************************************************************************************************/
