;/*********************************************************************************************************
;**
;**                                    中国软件开源组织
;**
;**                                   嵌入式实时操作系统
;**
;**                                       SylixOS(TM)
;**
;**                               Copyright  All Rights Reserved
;**
;**--------------文件信息--------------------------------------------------------------------------------
;**
;** 文   件   名: x64PentiumAsm.S
;**
;** 创   建   人: Jiao.JinXing (焦进星)
;**
;** 文件创建日期: 2017 年 06 月 02 日
;**
;** 描        述: x86-64 体系构架 Pentium 处理器 MSR 相关接口.
;*********************************************************************************************************/

#ifndef ASSEMBLY
#define ASSEMBLY 1
#endif

#include <arch/assembler.h>

    FILE_BEGIN()

    EXPORT_LABEL(x86PentiumMsrGet)
    EXPORT_LABEL(x86PentiumMsrSet)

;/*********************************************************************************************************
;  获取 Pentium MSR 寄存器值
;*********************************************************************************************************/

FUNC_DEF(x86PentiumMsrGet)
    MOV     X86_64_ARG0 , %RCX                                          ;/*  Specify MSR to read         */
    RDMSR                                                               ;/*  Read the MSR to %EDX:%EAX   */
    MOVL    %EAX , 0(X86_64_ARG1)                                       ;/*  Save low-order 32 bits      */
    MOVL    %EDX , 4(X86_64_ARG1)                                       ;/*  Save high-order 32 bits     */
    RET
    FUNC_END(x86PentiumMsrGet)

;/*********************************************************************************************************
;  设置 Pentium MSR 寄存器值
;*********************************************************************************************************/

FUNC_DEF(x86PentiumMsrSet)
    MOV     X86_64_ARG0 , %RCX                                          ;/*  Specify MSR to write        */
    MOVL    0(X86_64_ARG1) , %EAX                                       ;/*  Low-order 32 bits           */
    MOVL    4(X86_64_ARG1) , %EDX                                       ;/*  High-order 32 bits          */
    WRMSR                                                               ;/*  Write %EDX:%EAX to the MSR  */
    RET
    FUNC_END(x86PentiumMsrSet)

    FILE_END()

;/*********************************************************************************************************
;  END
;*********************************************************************************************************/
